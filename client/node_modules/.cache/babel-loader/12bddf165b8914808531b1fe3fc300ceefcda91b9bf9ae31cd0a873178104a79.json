{"ast":null,"code":"// Storage utilities for managing app data\n\n// Debounce utility for real-time saving\nconst debounce = (func, wait) => {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n};\n\n// Real-time save queue\nlet saveQueue = new Map();\nlet saveTimeout = null;\nconst processSaveQueue = () => {\n  saveQueue.forEach((value, key) => {\n    try {\n      localStorage.setItem(key, JSON.stringify(value));\n    } catch (error) {\n      console.warn(`Failed to save ${key} to localStorage:`, error);\n    }\n  });\n  saveQueue.clear();\n  saveTimeout = null;\n};\nconst queueSave = (key, value) => {\n  saveQueue.set(key, value);\n  if (saveTimeout) clearTimeout(saveTimeout);\n  saveTimeout = setTimeout(processSaveQueue, 500); // Save after 500ms of inactivity\n};\nexport const getStoredTheme = () => {\n  try {\n    return localStorage.getItem('theme') || 'light';\n  } catch (error) {\n    console.warn('Failed to get theme from localStorage:', error);\n    return 'light';\n  }\n};\nexport const getStoredUser = () => {\n  try {\n    const user = localStorage.getItem('user');\n    return user ? JSON.parse(user) : null;\n  } catch (error) {\n    console.warn('Failed to get user from localStorage:', error);\n    return null;\n  }\n};\nexport const setStoredTheme = theme => {\n  try {\n    localStorage.setItem('theme', theme);\n  } catch (error) {\n    console.warn('Failed to save theme to localStorage:', error);\n  }\n};\n\n// Force save all queued data immediately\nexport const forceSaveAll = () => {\n  if (saveTimeout) {\n    clearTimeout(saveTimeout);\n    processSaveQueue();\n  }\n};\n\n// Cross-tab synchronization\nlet storageChannel = null;\nexport const initializeStorageSync = () => {\n  if (typeof window !== 'undefined' && window.BroadcastChannel) {\n    storageChannel = new BroadcastChannel('knigabel-storage-sync');\n    storageChannel.onmessage = event => {\n      const {\n        key,\n        value\n      } = event.data;\n      try {\n        localStorage.setItem(key, JSON.stringify(value));\n        // Trigger custom event for components to update\n        window.dispatchEvent(new CustomEvent('storage-sync', {\n          detail: {\n            key,\n            value\n          }\n        }));\n      } catch (error) {\n        console.warn('Failed to sync storage:', error);\n      }\n    };\n  }\n};\nexport const syncDataAcrossTabs = (key, value) => {\n  if (storageChannel) {\n    storageChannel.postMessage({\n      key,\n      value\n    });\n  }\n};\n\n// Enhanced save function with cross-tab sync\nconst enhancedQueueSave = (key, value) => {\n  queueSave(key, value);\n  syncDataAcrossTabs(key, value);\n};\nexport const setStoredUser = user => {\n  enhancedQueueSave('user', user);\n};\nexport const setStoredBooks = books => {\n  enhancedQueueSave('books', books);\n};\nexport const setStoredFavorites = favorites => {\n  enhancedQueueSave('favorites', favorites);\n};\nexport const setStoredReadingProgress = progress => {\n  enhancedQueueSave('readingProgress', progress);\n};\nexport const clearAllData = () => {\n  try {\n    const keysToKeep = ['theme']; // Keep theme preference\n    const allKeys = Object.keys(localStorage);\n    allKeys.forEach(key => {\n      if (!keysToKeep.includes(key)) {\n        localStorage.removeItem(key);\n      }\n    });\n\n    // Clear save queue\n    saveQueue.clear();\n    if (saveTimeout) {\n      clearTimeout(saveTimeout);\n      saveTimeout = null;\n    }\n    return true;\n  } catch (error) {\n    console.warn('Failed to clear localStorage:', error);\n    return false;\n  }\n};","map":{"version":3,"names":["debounce","func","wait","timeout","executedFunction","args","later","clearTimeout","setTimeout","saveQueue","Map","saveTimeout","processSaveQueue","forEach","value","key","localStorage","setItem","JSON","stringify","error","console","warn","clear","queueSave","set","getStoredTheme","getItem","getStoredUser","user","parse","setStoredTheme","theme","forceSaveAll","storageChannel","initializeStorageSync","window","BroadcastChannel","onmessage","event","data","dispatchEvent","CustomEvent","detail","syncDataAcrossTabs","postMessage","enhancedQueueSave","setStoredUser","setStoredBooks","books","setStoredFavorites","favorites","setStoredReadingProgress","progress","clearAllData","keysToKeep","allKeys","Object","keys","includes","removeItem"],"sources":["C:/Users/kolas/Desktop/knigabel/client/src/utils/storage.js"],"sourcesContent":["// Storage utilities for managing app data\r\n\r\n// Debounce utility for real-time saving\r\nconst debounce = (func, wait) => {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n};\r\n\r\n// Real-time save queue\r\nlet saveQueue = new Map();\r\nlet saveTimeout = null;\r\n\r\nconst processSaveQueue = () => {\r\n  saveQueue.forEach((value, key) => {\r\n    try {\r\n      localStorage.setItem(key, JSON.stringify(value));\r\n    } catch (error) {\r\n      console.warn(`Failed to save ${key} to localStorage:`, error);\r\n    }\r\n  });\r\n  saveQueue.clear();\r\n  saveTimeout = null;\r\n};\r\n\r\nconst queueSave = (key, value) => {\r\n  saveQueue.set(key, value);\r\n  if (saveTimeout) clearTimeout(saveTimeout);\r\n  saveTimeout = setTimeout(processSaveQueue, 500); // Save after 500ms of inactivity\r\n};\r\n\r\nexport const getStoredTheme = () => {\r\n  try {\r\n    return localStorage.getItem('theme') || 'light';\r\n  } catch (error) {\r\n    console.warn('Failed to get theme from localStorage:', error);\r\n    return 'light';\r\n  }\r\n};\r\n\r\nexport const getStoredUser = () => {\r\n  try {\r\n    const user = localStorage.getItem('user');\r\n    return user ? JSON.parse(user) : null;\r\n  } catch (error) {\r\n    console.warn('Failed to get user from localStorage:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const setStoredTheme = (theme) => {\r\n  try {\r\n    localStorage.setItem('theme', theme);\r\n  } catch (error) {\r\n    console.warn('Failed to save theme to localStorage:', error);\r\n  }\r\n};\r\n\r\n\r\n// Force save all queued data immediately\r\nexport const forceSaveAll = () => {\r\n  if (saveTimeout) {\r\n    clearTimeout(saveTimeout);\r\n    processSaveQueue();\r\n  }\r\n};\r\n\r\n// Cross-tab synchronization\r\nlet storageChannel = null;\r\n\r\nexport const initializeStorageSync = () => {\r\n  if (typeof window !== 'undefined' && window.BroadcastChannel) {\r\n    storageChannel = new BroadcastChannel('knigabel-storage-sync');\r\n\r\n    storageChannel.onmessage = (event) => {\r\n      const { key, value } = event.data;\r\n      try {\r\n        localStorage.setItem(key, JSON.stringify(value));\r\n        // Trigger custom event for components to update\r\n        window.dispatchEvent(new CustomEvent('storage-sync', {\r\n          detail: { key, value }\r\n        }));\r\n      } catch (error) {\r\n        console.warn('Failed to sync storage:', error);\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nexport const syncDataAcrossTabs = (key, value) => {\r\n  if (storageChannel) {\r\n    storageChannel.postMessage({ key, value });\r\n  }\r\n};\r\n\r\n// Enhanced save function with cross-tab sync\r\nconst enhancedQueueSave = (key, value) => {\r\n  queueSave(key, value);\r\n  syncDataAcrossTabs(key, value);\r\n};\r\n\r\nexport const setStoredUser = (user) => {\r\n  enhancedQueueSave('user', user);\r\n};\r\n\r\nexport const setStoredBooks = (books) => {\r\n  enhancedQueueSave('books', books);\r\n};\r\n\r\nexport const setStoredFavorites = (favorites) => {\r\n  enhancedQueueSave('favorites', favorites);\r\n};\r\n\r\nexport const setStoredReadingProgress = (progress) => {\r\n  enhancedQueueSave('readingProgress', progress);\r\n};\r\n\r\nexport const clearAllData = () => {\r\n  try {\r\n    const keysToKeep = ['theme']; // Keep theme preference\r\n    const allKeys = Object.keys(localStorage);\r\n\r\n    allKeys.forEach(key => {\r\n      if (!keysToKeep.includes(key)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n\r\n    // Clear save queue\r\n    saveQueue.clear();\r\n    if (saveTimeout) {\r\n      clearTimeout(saveTimeout);\r\n      saveTimeout = null;\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.warn('Failed to clear localStorage:', error);\r\n    return false;\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}